<!DOCTYPE html>
<html>
<head>
    <title>Remote Camera</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #videoContainer {
            margin: 20px auto;
            max-width: 600px;
        }
        #qrCode {
            margin: 20px;
        }
        #peerIdInput {
            padding: 10px;
            margin: 10px;
            width: 200px;
        }
    </style>
</head>
<body>
    <!-- Cho ƒëi·ªán tho·∫°i -->
    <div id="mobileUI">
        <h2>üì± ƒêi·ªán Tho·∫°i (Camera)</h2>
        <video id="localVideo" autoplay playsinline muted></video>
        <div id="qrCode"></div>
    </div>

    <!-- Cho m√°y t√≠nh -->
    <div id="desktopUI" style="display: none;">
        <h2>üñ• M√°y T√≠nh (Xem camera)</h2>
        <input type="text" id="peerIdInput" placeholder="Nh·∫≠p ID ƒëi·ªán tho·∫°i">
        <button onclick="connectToPeer()">K·∫øt n·ªëi</button>
        <video id="remoteVideo" autoplay playsinline></video>
    </div>

    <script>
        const peer = new Peer({
            host: '0.peerjs.com',
            port: 443,
            path: '/'
        });

        // Ph√°t hi·ªán thi·∫øt b·ªã
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        document.getElementById('mobileUI').style.display = isMobile ? 'block' : 'none';
        document.getElementById('desktopUI').style.display = isMobile ? 'none' : 'block';

        // Cho ƒëi·ªán tho·∫°i
        if(isMobile) {
            let localStream;
            
            // Kh·ªüi t·∫°o camera
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    localStream = stream;
                    document.getElementById('localVideo').srcObject = stream;
                });

            // T·∫°o QR code khi c√≥ ID peer
            peer.on('open', id => {
                new QRCode(document.getElementById('qrCode'), {
                    text: id,
                    width: 200,
                    height: 200
                });
            });

            // X·ª≠ l√Ω k·∫øt n·ªëi ƒë·∫øn
            peer.on('connection', conn => {
                conn.on('open', () => {
                    // G·ª≠i video stream khi c√≥ k·∫øt n·ªëi
                    const call = peer.call(conn.peer, localStream);
                });
            });
        }

        // Cho m√°y t√≠nh
        else {
            let remoteStream;

            function connectToPeer() {
                const peerId = document.getElementById('peerIdInput').value;
                const conn = peer.connect(peerId);
                
                conn.on('open', () => {
                    // G·ªçi ƒë·∫øn ƒëi·ªán tho·∫°i
                    const call = peer.call(peerId, null);
                    
                    call.on('stream', stream => {
                        remoteStream = stream;
                        document.getElementById('remoteVideo').srcObject = stream;
                    });
                });
            }
        }

        // X·ª≠ l√Ω l·ªói
        peer.on('error', err => console.error('PeerJS error:', err));
    </script>
</body>
</html>
