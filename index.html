<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêi·ªÅu khi·ªÉn ESP32-CAM t·ª´ xa</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
        }
        #videoContainer {
            position: relative;
            margin: 20px 0;
        }
        #stream {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #ipInput {
            padding: 10px;
            width: 200px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ƒêi·ªÅu khi·ªÉn ESP32-CAM t·ª´ xa</h1>
    
    <div>
        <input type="text" id="ipInput" placeholder="Nh·∫≠p IP ESP32-CAM">
        <button onclick="saveIP()">L∆∞u IP</button>
    </div>
    
    <div id="videoContainer">
        <img id="stream" src="" alt="Video Stream">
    </div>
    
    <div class="controls">
        <button onclick="captureImage()">üì∏ Ch·ª•p ·∫£nh</button>
        <button onclick="toggleFlash()">‚ö° ƒê√®n Flash</button>
    </div>
    
    <div id="status" class="status"></div>

    <script>
        // L∆∞u IP v√†o localStorage
        function saveIP() {
            const ip = document.getElementById('ipInput').value;
            if(ip) {
                localStorage.setItem('esp32_ip', ip);
                showStatus(`ƒê√£ l∆∞u IP: ${ip}`, 'success');
                startStream();
            }
        }

        // Load IP ƒë√£ l∆∞u
        function loadIP() {
            const savedIP = localStorage.getItem('esp32_ip');
            if(savedIP) {
                document.getElementById('ipInput').value = savedIP;
                startStream();
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            setTimeout(() => statusDiv.textContent = '', 3000);
        }

        // B·∫≠t/t·∫Øt ƒë√®n flash
        function toggleFlash() {
            const ip = localStorage.getItem('esp32_ip');
            if(!ip) {
                showStatus('Vui l√≤ng nh·∫≠p IP tr∆∞·ªõc!', 'error');
                return;
            }
            
            fetch(`http://${ip}/flash`)
                .then(response => response.text())
                .then(text => showStatus(text, 'success'))
                .catch(err => showStatus('L·ªói k·∫øt n·ªëi!', 'error'));
        }

        // Ch·ª•p ·∫£nh
        function captureImage() {
            const ip = localStorage.getItem('esp32_ip');
            if(!ip) {
                showStatus('Vui l√≤ng nh·∫≠p IP tr∆∞·ªõc!', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.href = `http://${ip}/capture?${Date.now()}`; // Th√™m timestamp ƒë·ªÉ tr√°nh cache
            link.download = 'esp32-capture.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus('ƒê√£ ch·ª•p ·∫£nh!', 'success');
        }

        // B·∫≠t video stream
        function startStream() {
            const ip = localStorage.getItem('esp32_ip');
            if(ip) {
                document.getElementById('stream').src = `http://${ip}/stream`;
                showStatus('ƒê√£ k·∫øt n·ªëi video stream!', 'success');
            }
        }

        // T·ª± ƒë·ªông load IP khi trang web m·ªü
        window.onload = loadIP;
    </script>
</body>
</html>
