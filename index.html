<!DOCTYPE html>
<html>
<head>
    <title>Remote Camera Login</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        /* UI cho ƒëi·ªán tho·∫°i */
        #mobileUI {
            display: none;
            max-width: 500px;
            margin: 0 auto;
        }
        /* UI cho m√°y t√≠nh */
        #desktopUI {
            display: none;
            max-width: 500px;
            margin: 0 auto;
        }
        #peerId {
            font-size: 1.2em;
            color: #2c3e50;
            margin: 20px;
            word-break: break-all;
        }
        video {
            width: 100%;
            border-radius: 10px;
            background: #000;
        }
        input, button {
            padding: 12px;
            margin: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #3498db;
            color: white;
            cursor: pointer;
        }
        #qrBox {
            margin: 20px auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- Giao di·ªán ƒëi·ªán tho·∫°i -->
    <div id="mobileUI">
        <h2>üì± ƒêi·ªán Tho·∫°i</h2>
        <video id="localVideo" autoplay playsinline muted></video>
        <div id="connectionInfo">
            <p>ID c·ªßa b·∫°n:</p>
            <div id="peerId">ƒêang t·∫°o ID...</div>
            <div id="qrBox"></div>
            <button onclick="copyID()">Sao ch√©p ID</button>
        </div>
    </div>

    <!-- Giao di·ªán m√°y t√≠nh -->
    <div id="desktopUI">
        <h2>üñ• M√°y T√≠nh</h2>
        <input type="text" id="inputID" placeholder="Nh·∫≠p ID ƒëi·ªán tho·∫°i">
        <button onclick="connect()">K·∫øt n·ªëi</button>
        <video id="remoteVideo"></video>
    </div>

    <script>
        // Ph√°t hi·ªán thi·∫øt b·ªã
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const mobileUI = document.getElementById('mobileUI');
        const desktopUI = document.getElementById('desktopUI');
        
        if(isMobile) {
            mobileUI.style.display = 'block';
            initPhone();
        } else {
            desktopUI.style.display = 'block';
        }

        // ========== PH·∫¶N ƒêI·ªÜN THO·∫†I ==========
        let phonePeer;
        let localStream;

        async function initPhone() {
            try {
                // Kh·ªüi t·∫°o camera
                localStream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('localVideo').srcObject = localStream;

                // T·∫°o peer connection
                phonePeer = new Peer({
                    host: '0.peerjs.com',
                    port: 443,
                    path: '/'
                });

                // Hi·ªÉn th·ªã ID khi ready
                phonePeer.on('open', id => {
                    document.getElementById('peerId').textContent = id;
                    new QRCode(document.getElementById('qrBox'), {
                        text: id,
                        width: 150,
                        height: 150
                    });
                });

                // X·ª≠ l√Ω k·∫øt n·ªëi ƒë·∫øn
                phonePeer.on('call', call => {
                    call.answer(localStream); // G·ª≠i stream cho m√°y t√≠nh
                });

            } catch (error) {
                alert('L·ªói truy c·∫≠p camera: ' + error.message);
            }
        }

        function copyID() {
            const id = document.getElementById('peerId').textContent;
            navigator.clipboard.writeText(id);
            alert('ƒê√£ sao ch√©p ID!');
        }

        // ========== PH·∫¶N M√ÅY T√çNH ==========
        let computerPeer;

        function connect() {
            const phoneID = document.getElementById('inputID').value;
            if(!phoneID) return alert('Vui l√≤ng nh·∫≠p ID ƒëi·ªán tho·∫°i');

            computerPeer = new Peer({
                host: '0.peerjs.com',
                port: 443,
                path: '/'
            });

            computerPeer.on('open', () => {
                const call = computerPeer.call(phoneID, null); // G·ªçi ƒë·∫øn ƒëi·ªán tho·∫°i
                
                call.on('stream', remoteStream => {
                    const remoteVideo = document.getElementById('remoteVideo');
                    remoteVideo.srcObject = remoteStream;
                    remoteVideo.play();
                });
            });

            computerPeer.on('error', err => {
                alert('L·ªói k·∫øt n·ªëi: ' + err.message);
            });
        }
    </script>
</body>
</html>
